# 要件定義書

## 概要

本アプリケーションは名前を"家計簿アプリ"と呼ぶ。

その名前が示す通り、紙の家計簿を電子化したものである。


## 機能要件

以下に示すように機能のまとまりを分ける。
* 変動費の記録
* 固定費の記録
* 貯金額の記録
* 預金額の管理
* ユーザーの管理

上記についてそれぞれ詳細に要件を定義する。


### 変動費の記録

変動費の記録については以下の機能が要求される。
1. 記録日の収入を記録する機能
2. 記録日の生活費を記録する機能
3. 記録日の個人支出を記録する機能
4. 記録日の支出合計を記録する機能
5. 記録日の予算残金を記録する機能
6. 1日の収支情報を閲覧する機能

それぞれの機能の詳細を記述する。


#### 記録日の収入を記録する機能

この機能では対象とする日付に発生した収入を記録する。
預金残高にお金が追加された時などに入力する。


#### 記録日の生活費を記録する機能

この機能では対象とする日付に発生した生活費を記録する。
記録は生活費の種類ごとに行う。
なお、電気, ガス, 水道, 家賃などの毎月固定日に発生する支出に関しては本機能では記録しない。


#### 記録日の個人支出を記録する機能

この機能では対象とする日付に発生した個人支出を記録する。
金額の記録時に何に使用したのかを入力する。


#### 記録日の支出合計を記録する機能

「記録日の生活費を記録する機能」と「記録日の個人支出を記録する機能」で記録された支出の合計を計算し記録する。

計算式は以下とする。
```
( 「記録日の生活費を記録する機能」で記録された金額の合計 ÷ ユーザーグループの人数 ) + 「記録日の個人支出を記録する機能」で記録された金額の合計
```

アプリケーション側で自動で計算を行い記録する。


#### 記録日の予算残金を記録する機能

記録日の予算残金を計算し記録する。

予算残金の計算式は以下とする。
```
記録日の前日時点での予算残金 - 「記録日の生活費を記録する機能」で記録された金額の合計
```

アプリケーション側で自動で計算を行い記録する。


#### 1日の収支情報を閲覧する機能

以下の機能で記録された情報を閲覧する。
1. 記録日の収入を記録する機能
2. 記録日の生活費を記録する機能
3. 記録日の個人支出を記録する機能
4. 記録日の支出合計を記録する機能
5. 記録日の予算残金を記録する機能


### 固定費の記録

固定費の記録については以下の機能が要求される。
1. 月の固定費の種類を設定する機能
2. 月の固定費の金額を設定する機能
3. 月の固定費の金額を変更する機能
4. 記録月の固定費の金額を設定する機能

それぞれの機能の詳細を記述する。


#### 月の固定費の種類を設定する機能

この機能では毎月発生する固定費の種類を設定する。
例えば「ガス代」や「家賃」など。


#### 月の固定費の金額を設定する機能

毎月支払う金額が決まっている場合はこの機能を使用してあらかじめ金額を設定する。


#### 月の固定費の金額を変更する機能

毎月支払う金額が決まっている固定費に関して、金額が変動した場合はこの機能で設定を変更する。
いつからその金額が適用されるのかも同時に設定する。


#### 記録月の固定費の金額を設定する機能

毎月支払う金額が決まっていない固定費に関して、記録月分の金額を記録する。


### 貯金額の記録

貯金額の記録については以下の機能が要求される。
1. 記録月の貯金額を設定する機能


#### 記録月の貯金額を設定する機能

記録月にいくら貯金を行うのか記録する。


### 預金額の管理

預金額の管理については以下の機能が要求される。
1. 預金残高を設定する機能
2. 月の予算金を設定する機能
3. 預金残高を計算する機能
4. 預金残高を編集する機能


#### 預金残高を設定する機能

金融口座ごとの預金残高を設定する。

金融口座のうち一つの口座を「変動費の記録」機能群で使用される残高として設定する。
それ以外の口座は「貯金額の記録」機能群で使用される残高として設定される。


#### 月の予算金を設定する機能

月の予算額を設定する。

この予算額は生活費の予算金となる。


#### 預金残高を計算する機能

預金残高を以下の計算式で自動計算し更新する。

計算式は以下とする。
```
新残高 = 前回残高 + 収入 - 支出合計 - 固定費合計 - 貯金額
```

アプリケーション側で自動で計算を行い記録する。


#### 預金残高を編集する機能

実際の口座残高とアプリケーション上の残高にずれが発生した場合に、預金残高を手動で編集できる。
編集時には編集理由を記録する。


### ユーザーの管理

家計を同一とするユーザーを管理する
以下の機能が要求される。
1. ユーザーを登録する機能
2. ログインする機能
3. ユーザーグループを作成する機能
4. ユーザーグループに参加する機能
5. ユーザーグループに招待する機能
6. 招待を承認・拒否する機能
7. ユーザーグループから脱退する機能


#### ユーザーを登録する機能

ユーザーを登録する
以下のユーザー情報を記録する。
* ユーザー名
* パスワード


#### ログインする機能

システムにログインする。
ユーザー名とパスワードを入力してもらい認証を行う。


#### ユーザーグループを作成する機能

ユーザーグループを作成する。
ユーザーグループは生計を同一とする家族を表す。

ユーザーは1つのユーザーグループにしか所属できず、すでにユーザーグループに所属している場合新しいユーザーグループを作成することはできない。


#### ユーザーグループに参加する機能

ユーザーグループに参加する。


#### ユーザーグループに招待する機能

現在所属しているユーザーグループにユーザーを招待する。


#### 招待を承認・拒否する機能

ユーザーグループへの招待を受けた場合、以下の操作を行う。
- 招待の承認：ユーザーグループへ参加
- 招待の拒否：招待を削除
- 招待の有効期限：設定しない（いつでも承認・拒否可能）


#### ユーザーグループから脱退する機能

現在所属しているユーザーグループから脱退する。
- ユーザーはいつでも脱退可能
- 脱退後も過去の収支情報は保持される
- 脱退したユーザーのデータは他のグループメンバーからも引き続き閲覧可能


## データ管理仕様

### 生活費の種類管理

生活費の種類は以下の仕様で管理する。
- 基本的な種類（食費、交通費、日用品等）を事前定義済みとして提供
- ユーザーは必要に応じて新しい種類を追加可能
- 既存の種類の名称を編集可能
- 不要な種類を削除可能（ただし、使用履歴がある場合は削除制限を設ける）


### データの修正・削除

すべての記録データについて以下の操作を許可する。
- 入力ミスの修正：いつでも可能
- 誤入力の削除：いつでも可能
- 修正・削除の履歴：保持しない


### データ保持期間

- すべてのデータを無制限に保存
- アーカイブ機能は提供しない


## セキュリティ・認証仕様

### パスワード要件

ユーザー登録時のパスワードは以下の要件を満たす必要がある。
- 8文字以上の英数字
- 英字と数字の両方を含む必要がある


### セッション管理

ユーザーのログイン状態について以下の仕様とする。
- ログイン状態の維持期間：1週間
- 1週間後は自動的にログアウト
- 手動ログアウト機能を提供
- 自動ログアウト機能（一定時間操作なしでのログアウト）は提供しない


### 権限制御

データアクセスの権限を以下のように制御する。


#### グループ間のデータ分離
- 所属していないユーザーグループのデータは一切閲覧不可
- 各ユーザーは所属グループのデータのみアクセス可能


#### グループ内でのデータ共有範囲
- **共有データ**：生活費の記録、固定費（全グループメンバーが閲覧可能）
- **非共有データ**：個人支出の詳細、収入、貯金額、預金残高（記録者本人のみ閲覧可能）


## 業務ルール

### 月次予算の設定権限

月次予算の設定について以下のルールを適用する。
- グループの全メンバーが月次予算を設定・更新可能
- 複数のメンバーが異なる予算を設定した場合、最後に設定された金額を有効とする
- 予算変更の履歴は保持しない


### 複数口座の資金移動

口座間の資金移動について以下の方針とする。
- システムでは自動的な口座間移動の記録は行わない
- 資金移動が発生した場合、ユーザーが手動で各口座の預金残高を更新する
- 移動理由の記録は預金残高編集機能の編集理由として記録可能


### 予算残金の月次処理

月をまたいだ際の予算残金処理について以下のルールを適用する。
- 予算残金は月の始まりにリセットされる（前月の残金は引き継がない）
- 月の始まり日はユーザーグループごとに設定可能（例：1日、25日など）
- 新月開始時の予算残金は、その月の設定予算額と同額になる
